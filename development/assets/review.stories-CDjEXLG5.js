var b=n=>{throw TypeError(n)};var F=(n,e,t)=>e.has(n)||b("Cannot "+t);var l=(n,e,t)=>(F(n,e,"read from private field"),t?t.call(n):e.get(n)),u=(n,e,t)=>e.has(n)?b("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),h=(n,e,t,r)=>(F(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t),m=(n,e,t)=>(F(n,e,"access private method"),t);import{r as c,R as A,j as i,L as M,_ as g}from"./index-B5QrPmTG.js";import{a as L}from"./app-ids-CkH1oDs0.js";import{S as Q}from"./star-icon-DZbNv4n5.js";import{R as X}from"./right-arrow-icon-CBW2C3Xp.js";const N=n=>{const[e,t]=c.useState(!1);return c.useEffect(()=>{t(window.matchMedia(n).matches)},[]),c.useEffect(()=>{const r=window.matchMedia(n),s=o=>t(o.matches);return r.addEventListener("change",s),()=>r.removeEventListener("change",s)},[]),e};var x;class G{constructor(){u(this,x);this.getReviewData=async e=>await(await fetch(l(this,x).call(this,e))).json(),h(this,x,({appId:e,dataType:t="json",countryCode:r="us",page:s=1})=>`https://itunes.apple.com/${r}/rss/customerreviews/page=${s}/id=${e}/sortBy=mostRecent/${t}?l=en&cc=gb`)}}x=new WeakMap;const{getReviewData:Z}=new G;var E,y,R,p,j,S,I,w;class Y{constructor(){u(this,E);u(this,y);u(this,R);u(this,p);u(this,j);u(this,S);u(this,I);u(this,w);this.validateReviewMsg=async({data:e,settings:t})=>{const r=getComputedStyle(e.origElem),s=l(this,R).call(this,{data:{origElemStyles:r}}),o=l(this,j).call(this,{data:{origElemStyles:r},settings:t}),d=e.origElem.scrollHeight>o;if(e.origElem.dataset.overflowFlag==="true"||d){e.origElem.dataset.overflowFlag="true",document.body.appendChild(s);const J=await l(this,E).call(this,{data:{...e,tempElem:s},settings:{maxHeight:o}});document.body.removeChild(s);const K=l(this,p).call(this,t.endElem).length;return{overflowFlag:!0,content:[await l(this,y).call(this,{data:e,settings:{endElemLength:K,truncationIndex:J}}),t.endElem]}}return e.origElem.dataset.overflowFlag="false",{overflowFlag:!1,content:[e.origMsg]}},h(this,E,async({data:e,settings:t})=>{if(!e.origMsg.length)return 0;let r=0,s=e.origMsg.length-1;for(;r<=s;){const o=Math.floor((r+s)/2),d=e.origMsg.substring(0,o);e.tempElem.textContent=d,e.tempElem.scrollHeight<=t.maxHeight?r=o+1:s=o-1}return s}),h(this,y,async({data:e,settings:t})=>{if(t.truncationIndex===0)return e.origMsg;const r=t.truncationIndex-t.endElemLength,s=e.origMsg.lastIndexOf(" ",r);return s<0?e.origMsg.substring(0,r):e.origMsg.substring(0,s).replace(new RegExp("\\p{P}+$","gu"),"").trim()}),h(this,R,({data:e})=>{const t=document.createElement("div");return t.style.position="absolute",t.style.visibility="hidden",t.style.overflow="hidden",t.style.display="inline-block",t.style.whiteSpace="pre-wrap",t.style.fontSize=e.origElemStyles.fontSize,t.style.lineHeight=e.origElemStyles.lineHeight,t.style.fontFamily=e.origElemStyles.fontFamily,t.style.padding=e.origElemStyles.padding,t.style.margin=e.origElemStyles.margin,t.style.border=e.origElemStyles.border,t.style.maxWidth=e.origElemStyles.width,t.style.maxHeight=e.origElemStyles.height,t}),h(this,p,e=>typeof e=="string"?e:typeof e=="number"?e.toString():A.isValidElement(e)?A.Children.toArray(e.props.children).map(l(this,p)).join(""):""),h(this,j,({data:e,settings:t})=>t.rows*l(this,S).call(this,{data:{origElemStyles:e.origElemStyles}})),h(this,S,({data:e})=>parseFloat(e.origElemStyles.lineHeight)||parseFloat(e.origElemStyles.fontSize)),this.validateReviewData=async({reviewData:e,arrLength:t})=>e?Array.isArray(e)?e.length<t?[...e,...l(this,w).call(this,t-e.length)]:e:[e,...l(this,w).call(this,t-1)]:l(this,w).call(this,t),h(this,I,()=>({filler:!0})),h(this,w,e=>Array(e).fill(l(this,I).call(this)))}}E=new WeakMap,y=new WeakMap,R=new WeakMap,p=new WeakMap,j=new WeakMap,S=new WeakMap,I=new WeakMap,w=new WeakMap;const{validateReviewData:T,validateReviewMsg:q}=new Y;var a,$,W,O,v,_;class ee{constructor(){u(this,a);this.sortReviews=async({validatedData:e,lang:t})=>e.sort((r,s)=>m(this,a,v).call(this,r)&&m(this,a,v).call(this,s)?0:m(this,a,v).call(this,r)?1:m(this,a,v).call(this,s)?-1:m(this,a,$).call(this,r,s,t))}}a=new WeakSet,$=function(e,t,r){const s=m(this,a,O).call(this,e,t);return s!==0?s:m(this,a,W).call(this,e,t,r)},W=function(e,t,r){const s=m(this,a,_).call(this,e.content.label,r),o=m(this,a,_).call(this,t.content.label,r);return s===o?0:s&&!o?-1:1},O=function(e,t){const r=parseInt(e["im:rating"].label);return parseInt(t["im:rating"].label)-r},v=function(e){return"filler"in e},_=function(e,t){const s={ar:/[\u0621-\u064A\u0660-\u0669]/,en:/[a-zA-Z]/,ru:/[а-яА-ЯёЁ]/,de:/[äöüß]/,hi:/[अ-ह]/,es:/[ñáéíóúü]/,fr:/[àâçéèêëîïôûù]/,zh:/[\u4E00-\u9FFF]/,ja:/[\u3040-\u30FF\uFF00-\uFFEF]/,pt:/[ãáâéêíóôú]/,uk:/[єіїґ]/}[t];return s?s.test(e):!1};const{sortReviews:te}=new ee;class ne{constructor(){this.getAppId=()=>{const t=new URL(document.URL).pathname.split("/");let r;for(r in L)if(t.includes(r))return L[r];throw new Error(`ID NOT FOUND, pathnameItems:${JSON.stringify(t)}, appIds: ${JSON.stringify(L)}`)},this.getAppStoreLink=({data:e,option:t})=>`https://apps.apple.com/${e.countryCode||"us"}/app/id${e.appId}${t&&`?${t}`}`}}const{getAppId:Se,getAppStoreLink:V}=new ne,re=({codes:n,arrLength:e=3,appId:t})=>{const[r,s]=c.useState(null);return c.useEffect(()=>{Z({appId:t,countryCode:n.countryCode||"us"}).then(o=>T({reviewData:o.feed.entry,arrLength:e})).then(o=>te({validatedData:o,lang:n.languageCode||"en"})).then(o=>s(o)).catch(()=>T({reviewData:[],arrLength:e}).then(o=>s(o)))},[]),{reviews:r}},P=c.createContext(null);function f(){const n=c.useContext(P);if(!n)throw new Error("ReviewContext must be used inside ReviewProvider");return n}function ie({head:n,description:e,link:t,slider:r}){return i.jsxs(B,{children:[i.jsxs("header",{className:"review__header",children:[n,t]}),e,r]})}function se({head:n,description:e,link:t,slider:r}){return i.jsxs(B,{children:[i.jsx("header",{className:"review__header",children:n}),e,r,i.jsx("footer",{className:"review__link-wrapper pt-4",children:t})]})}function B({children:n}){return i.jsx("section",{children:i.jsx("div",{className:"row review py-5",children:n})})}function k(){const{text:n}=f();return i.jsx("h2",{children:n.head})}function D(){const{text:n}=f();return i.jsx("p",{className:"review__description",children:n.description})}const oe=(n,e)=>{let t;return(...r)=>{t&&clearTimeout(t),t=setTimeout(()=>n(...r),e)}},ae=(n=1e3)=>{const[e,t]=c.useState({width:window.innerWidth,height:window.innerHeight});return c.useEffect(()=>{const r=oe(()=>{t({width:window.innerWidth,height:window.innerHeight})},n);return window.addEventListener("resize",r),()=>{window.removeEventListener("resize",r)}},[n]),e},le=({data:n,settings:e})=>{const t=c.useRef(null),r=ae(e.resizeDelay),[s,o]=c.useState({overflowFlag:!1,content:[n.origMsg]});return c.useLayoutEffect(()=>{const d=t.current;d&&q({data:{...n,origElem:d},settings:e}).then(C=>o(C))},[r]),{validatedData:s,reviewTextRef:t}},ce=n=>new Date(n).toLocaleDateString("ru-RU");function de({reviewerNickname:n,createdDate:e,reviewText:t,rating:r}){const{reviewTextRef:s,validatedData:o}=le({data:{origMsg:t},settings:{rows:8,resizeDelay:100,endElem:i.jsx("span",{children:"..."},t)}});return i.jsxs("li",{className:"review-card",children:[i.jsxs("header",{className:"review-card__header",children:[i.jsxs("div",{className:"review-card__header-main",children:[i.jsx("h3",{children:n}),i.jsxs("span",{className:"review-card__header-rating",children:[i.jsx(Q,{}),r,",0"]})]}),i.jsx("time",{dateTime:e,children:ce(e)})]}),i.jsx("p",{ref:s,children:o.content})]})}function ue({link:n,posIndex:e}){const{text:t}=f();return i.jsx("li",{className:"review-card filler-card",children:i.jsxs("div",{className:"filler-card__wrapper",children:[i.jsx("h3",{className:"filler-card__header",children:t.fillerCard.head[e]}),n]})})}function he({rightIcon:n,text:e,href:t,isNewTab:r,color:s="#0d6efd",hoverColor:o="#0a58ca",hasUnderlineHover:d=!0}){const C=r&&{target:"_blank",rel:"noreferrer noopener"};return i.jsxs("a",{href:t,...C,className:`text-link-arrow d-flex align-items-center gap-2 text-decoration-none lh-sm ${d?"with-underline":""}`,style:{color:s,"--hover-color":o},children:[e,n]})}function me(){const{data:n,text:e}=f();return i.jsx(U,{text:e.fillerCard.link,href:V({data:{appId:n.appId,countryCode:n.countryCode},option:"action=write-review"})})}function H(){const{data:n,text:e}=f();return i.jsx(U,{text:e.link,href:V({data:{appId:n.appId,countryCode:n.countryCode},option:"see-all=reviews"})})}function U(n){return i.jsx(he,{rightIcon:i.jsx(X,{}),isNewTab:!0,...n})}function z(){const{data:n,text:e}=f();return i.jsx("ul",{className:"review__list",children:n.reviews.map((t,r)=>"filler"in t?i.jsx(ue,{link:i.jsx(me,{}),posIndex:r},e.fillerCard.head[r]):i.jsx(de,{createdDate:t.updated.label,reviewText:t.content.label,reviewerNickname:t.author.name.label,rating:t["im:rating"].label},t.id.label))})}const ge=992,we=1400;function pe({text:n,appId:e,codes:t}){const r=N(`(max-width: ${ge}px)`),s=N(`(max-width: ${we}px)`),o=r?1:s?2:3,{reviews:d}=re({codes:t,arrLength:o,appId:e});return!d||!e?i.jsx(i.Fragment,{}):i.jsx(P.Provider,{value:{data:{reviews:d.slice(0,o),appId:e,countryCode:t.countryCode},text:n},children:r?i.jsx(se,{head:i.jsx(k,{}),description:i.jsx(D,{}),link:i.jsx(H,{}),slider:i.jsx(z,{})}):i.jsx(ie,{head:i.jsx(k,{}),description:i.jsx(D,{}),link:i.jsx(H,{}),slider:i.jsx(z,{})})})}const Ie={title:"Prototype"},fe=()=>i.jsx(pe,{appId:L.vitamin,codes:{countryCode:M.countryCode,languageCode:M.language},text:{head:g("REVIEW.HEAD"),description:g("REVIEW.DESCRIPTION"),link:g("REVIEW.LINK_ALL_REVIEWS"),fillerCard:{head:[g("REVIEW.FILLER_CARD.HEAD1"),g("REVIEW.FILLER_CARD.HEAD2"),g("REVIEW.FILLER_CARD.HEAD3")],link:g("REVIEW.FILLER_CARD.LINK")}}});fe.storyName="Review";typeof window<"u"&&window.document&&window.document.createElement&&document.documentElement.setAttribute("data-storyloaded","");export{fe as ReviewStory,Ie as default};
