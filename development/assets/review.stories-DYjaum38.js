var _=n=>{throw TypeError(n)};var b=(n,e,t)=>e.has(n)||_("Cannot "+t);var l=(n,e,t)=>(b(n,e,"read from private field"),t?t.call(n):e.get(n)),u=(n,e,t)=>e.has(n)?_("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),h=(n,e,t,i)=>(b(n,e,"write to private field"),i?i.call(n,t):e.set(n,t),t),g=(n,e,t)=>(b(n,e,"access private method"),t);import{r as c,R as A,j as r,L as M,_ as m}from"./index-BadisBGm.js";const K=1519596234,Q=1562956213,X=1547395353,G=1507719251,Y=1506250420,q=1507588203,ee=1564205068,I={vitamin:K,emotion:Q,bodyzinc:X,electrolyte:G,waistline:Y,bodymass:q,bodysize:ee},N=n=>{const[e,t]=c.useState(!1);return c.useEffect(()=>{t(window.matchMedia(n).matches)},[]),c.useEffect(()=>{const i=window.matchMedia(n),s=o=>t(o.matches);return i.addEventListener("change",s),()=>i.removeEventListener("change",s)},[]),e};var x;class te{constructor(){u(this,x);this.getReviewData=async e=>await(await fetch(l(this,x).call(this,e))).json(),h(this,x,({appId:e,dataType:t="json",countryCode:i="us",page:s=1})=>`https://itunes.apple.com/${i}/rss/customerreviews/page=${s}/id=${e}/sortBy=mostRecent/${t}?l=en&cc=gb`)}}x=new WeakMap;const{getReviewData:ne}=new te;var y,E,R,p,j,C,S,w;class ie{constructor(){u(this,y);u(this,E);u(this,R);u(this,p);u(this,j);u(this,C);u(this,S);u(this,w);this.validateReviewMsg=async({data:e,settings:t})=>{const i=getComputedStyle(e.origElem),s=l(this,R).call(this,{data:{origElemStyles:i}}),o=l(this,j).call(this,{data:{origElemStyles:i},settings:t}),d=e.origElem.scrollHeight>o;if(e.origElem.dataset.overflowFlag==="true"||d){e.origElem.dataset.overflowFlag="true",document.body.appendChild(s);const Z=await l(this,y).call(this,{data:{...e,tempElem:s},settings:{maxHeight:o}});document.body.removeChild(s);const J=l(this,p).call(this,t.endElem).length;return{overflowFlag:!0,content:[await l(this,E).call(this,{data:e,settings:{endElemLength:J,truncationIndex:Z}}),t.endElem]}}return e.origElem.dataset.overflowFlag="false",{overflowFlag:!1,content:[e.origMsg]}},h(this,y,async({data:e,settings:t})=>{if(!e.origMsg.length)return 0;let i=0,s=e.origMsg.length-1;for(;i<=s;){const o=Math.floor((i+s)/2),d=e.origMsg.substring(0,o);e.tempElem.textContent=d,e.tempElem.scrollHeight<=t.maxHeight?i=o+1:s=o-1}return s}),h(this,E,async({data:e,settings:t})=>{if(t.truncationIndex===0)return e.origMsg;const i=t.truncationIndex-t.endElemLength,s=e.origMsg.lastIndexOf(" ",i);return s<0?e.origMsg.substring(0,i):e.origMsg.substring(0,s).replace(new RegExp("\\p{P}+$","gu"),"").trim()}),h(this,R,({data:e})=>{const t=document.createElement("div");return t.style.position="absolute",t.style.visibility="hidden",t.style.overflow="hidden",t.style.display="inline-block",t.style.whiteSpace="pre-wrap",t.style.fontSize=e.origElemStyles.fontSize,t.style.lineHeight=e.origElemStyles.lineHeight,t.style.fontFamily=e.origElemStyles.fontFamily,t.style.padding=e.origElemStyles.padding,t.style.margin=e.origElemStyles.margin,t.style.border=e.origElemStyles.border,t.style.maxWidth=e.origElemStyles.width,t.style.maxHeight=e.origElemStyles.height,t}),h(this,p,e=>typeof e=="string"?e:typeof e=="number"?e.toString():A.isValidElement(e)?A.Children.toArray(e.props.children).map(l(this,p)).join(""):""),h(this,j,({data:e,settings:t})=>t.rows*l(this,C).call(this,{data:{origElemStyles:e.origElemStyles}})),h(this,C,({data:e})=>parseFloat(e.origElemStyles.lineHeight)||parseFloat(e.origElemStyles.fontSize)),this.validateReviewData=async({reviewData:e,arrLength:t})=>e?Array.isArray(e)?e.length<t?[...e,...l(this,w).call(this,t-e.length)]:e:[e,...l(this,w).call(this,t-1)]:l(this,w).call(this,t),h(this,S,()=>({filler:!0})),h(this,w,e=>Array(e).fill(l(this,S).call(this)))}}y=new WeakMap,E=new WeakMap,R=new WeakMap,p=new WeakMap,j=new WeakMap,C=new WeakMap,S=new WeakMap,w=new WeakMap;const{validateReviewData:D,validateReviewMsg:re}=new ie;var a,$,W,O,v,F;class se{constructor(){u(this,a);this.sortReviews=async({validatedData:e,lang:t})=>e.sort((i,s)=>g(this,a,v).call(this,i)&&g(this,a,v).call(this,s)?0:g(this,a,v).call(this,i)?1:g(this,a,v).call(this,s)?-1:g(this,a,$).call(this,i,s,t))}}a=new WeakSet,$=function(e,t,i){const s=g(this,a,O).call(this,e,t);return s!==0?s:g(this,a,W).call(this,e,t,i)},W=function(e,t,i){const s=g(this,a,F).call(this,e.content.label,i),o=g(this,a,F).call(this,t.content.label,i);return s===o?0:s&&!o?-1:1},O=function(e,t){const i=parseInt(e["im:rating"].label);return parseInt(t["im:rating"].label)-i},v=function(e){return"filler"in e},F=function(e,t){const s={ar:/[\u0621-\u064A\u0660-\u0669]/,en:/[a-zA-Z]/,ru:/[а-яА-ЯёЁ]/,de:/[äöüß]/,hi:/[अ-ह]/,es:/[ñáéíóúü]/,fr:/[àâçéèêëîïôûù]/,zh:/[\u4E00-\u9FFF]/,ja:/[\u3040-\u30FF\uFF00-\uFFEF]/,pt:/[ãáâéêíóôú]/,uk:/[єіїґ]/}[t];return s?s.test(e):!1};const{sortReviews:oe}=new se;class ae{constructor(){this.getAppId=()=>{const t=new URL(document.URL).pathname.split("/");let i;for(i in I)if(t.includes(i))return I[i];throw new Error(`ID NOT FOUND, pathnameItems:${JSON.stringify(t)}, appIds: ${JSON.stringify(I)}`)},this.getAppStoreLink=({data:e,option:t})=>`https://apps.apple.com/${e.countryCode||"us"}/app/id${e.appId}${t&&`?${t}`}`}}const{getAppId:be,getAppStoreLink:V}=new ae,le=({codes:n,arrLength:e=3,appId:t})=>{const[i,s]=c.useState(null);return c.useEffect(()=>{ne({appId:t,countryCode:n.countryCode||"us"}).then(o=>D({reviewData:o.feed.entry,arrLength:e})).then(o=>oe({validatedData:o,lang:n.languageCode||"en"})).then(o=>s(o)).catch(()=>D({reviewData:[],arrLength:e}).then(o=>s(o)))},[]),{reviews:i}},P=c.createContext(null);function f(){const n=c.useContext(P);if(!n)throw new Error("ReviewContext must be used inside ReviewProvider");return n}function ce({head:n,description:e,link:t,slider:i}){return r.jsxs(B,{children:[r.jsxs("header",{className:"review__header",children:[n,t]}),e,i]})}function de({head:n,description:e,link:t,slider:i}){return r.jsxs(B,{children:[r.jsx("header",{className:"review__header",children:n}),e,i,r.jsx("footer",{className:"review__link-wrapper pt-4",children:t})]})}function B({children:n}){return r.jsx("section",{children:r.jsx("div",{className:"row review py-5",children:n})})}function T(){const{text:n}=f();return r.jsx("h2",{children:n.head})}function k(){const{text:n}=f();return r.jsx("p",{className:"review__description",children:n.description})}function ue(){return r.jsx("svg",{"aria-label":"star icon",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:r.jsx("path",{d:"M12.9685 5.22755L14.4643 8.24394C14.6683 8.66384 15.2122 9.0666 15.6712 9.14372L18.3824 9.59789C20.1162 9.88925 20.5242 11.1575 19.2748 12.4086L17.167 14.5338C16.8101 14.8937 16.6146 15.5878 16.7251 16.0848L17.3285 18.7156C17.8045 20.798 16.7081 21.6035 14.8808 20.5152L12.3396 18.9984C11.8806 18.7242 11.1242 18.7242 10.6567 18.9984L8.11553 20.5152C6.29673 21.6035 5.19185 20.7894 5.6678 18.7156L6.27123 16.0848C6.38172 15.5878 6.18624 14.8937 5.82928 14.5338L3.72151 12.4086C2.48065 11.1575 2.88011 9.88925 4.61391 9.59789L7.32511 9.14372C7.77557 9.0666 8.3195 8.66384 8.52348 8.24394L10.0193 5.22755C10.8352 3.59082 12.1611 3.59082 12.9685 5.22755Z",fill:"#FFDF35"})})}const he=(n,e)=>{let t;return(...i)=>{t&&clearTimeout(t),t=setTimeout(()=>n(...i),e)}},ge=(n=1e3)=>{const[e,t]=c.useState({width:window.innerWidth,height:window.innerHeight});return c.useEffect(()=>{const i=he(()=>{t({width:window.innerWidth,height:window.innerHeight})},n);return window.addEventListener("resize",i),()=>{window.removeEventListener("resize",i)}},[n]),e},me=({data:n,settings:e})=>{const t=c.useRef(null),i=ge(e.resizeDelay),[s,o]=c.useState({overflowFlag:!1,content:[n.origMsg]});return c.useLayoutEffect(()=>{const d=t.current;d&&re({data:{...n,origElem:d},settings:e}).then(L=>o(L))},[i]),{validatedData:s,reviewTextRef:t}},we=n=>new Date(n).toLocaleDateString("ru-RU");function pe({reviewerNickname:n,createdDate:e,reviewText:t,rating:i}){const{reviewTextRef:s,validatedData:o}=me({data:{origMsg:t},settings:{rows:8,resizeDelay:100,endElem:r.jsx("span",{children:"..."},t)}});return r.jsxs("li",{className:"review-card",children:[r.jsxs("header",{className:"review-card__header",children:[r.jsxs("div",{className:"review-card__header-main",children:[r.jsx("h3",{children:n}),r.jsxs("span",{className:"review-card__header-rating",children:[r.jsx(ue,{}),i,",0"]})]}),r.jsx("time",{dateTime:e,children:we(e)})]}),r.jsx("p",{ref:s,children:o.content})]})}function fe({link:n,posIndex:e}){const{text:t}=f();return r.jsx("li",{className:"review-card filler-card",children:r.jsxs("div",{className:"filler-card__wrapper",children:[r.jsx("h3",{className:"filler-card__header",children:t.fillerCard.head[e]}),n]})})}function ve(n){return r.jsx("svg",{"aria-label":"right arrow icon",width:"1em",height:"1em",viewBox:"0 0 19 9",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...n,children:r.jsx("path",{d:"m15.172.965 3.182 3.182a.5.5 0 0 1 0 .707l-3.182 3.182a.5.5 0 1 1-.708-.707L16.793 5H1a.5.5 0 0 1 0-1h15.793l-2.329-2.328a.5.5 0 1 1 .708-.707Z"})})}function xe({rightIcon:n,text:e,href:t,isNewTab:i,color:s="#0d6efd",hoverColor:o="#0a58ca",hasUnderlineHover:d=!0}){const L=i&&{target:"_blank",rel:"noreferrer noopener"};return r.jsxs("a",{href:t,...L,className:`text-link-arrow d-flex align-items-center gap-2 text-decoration-none lh-sm ${d?"with-underline":""}`,style:{color:s,"--hover-color":o},children:[e,n]})}function ye(){const{data:n,text:e}=f();return r.jsx(U,{text:e.fillerCard.link,href:V({data:{appId:n.appId,countryCode:n.countryCode},option:"action=write-review"})})}function z(){const{data:n,text:e}=f();return r.jsx(U,{text:e.link,href:V({data:{appId:n.appId,countryCode:n.countryCode},option:"see-all=reviews"})})}function U(n){return r.jsx(xe,{rightIcon:r.jsx(ve,{}),isNewTab:!0,...n})}function H(){const{data:n,text:e}=f();return r.jsx("ul",{className:"review__list",children:n.reviews.map((t,i)=>"filler"in t?r.jsx(fe,{link:r.jsx(ye,{}),posIndex:i},e.fillerCard.head[i]):r.jsx(pe,{createdDate:t.updated.label,reviewText:t.content.label,reviewerNickname:t.author.name.label,rating:t["im:rating"].label},t.id.label))})}const Ee=992,Re=1400;function je({text:n,appId:e,codes:t}){const i=N(`(max-width: ${Ee}px)`),s=N(`(max-width: ${Re}px)`),o=i?1:s?2:3,{reviews:d}=le({codes:t,arrLength:o,appId:e});return!d||!e?r.jsx(r.Fragment,{}):r.jsx(P.Provider,{value:{data:{reviews:d.slice(0,o),appId:e,countryCode:t.countryCode},text:n},children:i?r.jsx(de,{head:r.jsx(T,{}),description:r.jsx(k,{}),link:r.jsx(z,{}),slider:r.jsx(H,{})}):r.jsx(ce,{head:r.jsx(T,{}),description:r.jsx(k,{}),link:r.jsx(z,{}),slider:r.jsx(H,{})})})}const Fe={title:"Prototype"},Ce=()=>r.jsx(je,{appId:I.vitamin,codes:{countryCode:M.countryCode,languageCode:M.language},text:{head:m("REVIEW.HEAD"),description:m("REVIEW.DESCRIPTION"),link:m("REVIEW.LINK_ALL_REVIEWS"),fillerCard:{head:[m("REVIEW.FILLER_CARD.HEAD1"),m("REVIEW.FILLER_CARD.HEAD2"),m("REVIEW.FILLER_CARD.HEAD3")],link:m("REVIEW.FILLER_CARD.LINK")}}});Ce.storyName="Review";typeof window<"u"&&window.document&&window.document.createElement&&document.documentElement.setAttribute("data-storyloaded","");export{Ce as ReviewStory,Fe as default};
