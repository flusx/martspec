var b=i=>{throw TypeError(i)};var L=(i,e,t)=>e.has(i)||b("Cannot "+t);var l=(i,e,t)=>(L(i,e,"read from private field"),t?t.call(i):e.get(i)),d=(i,e,t)=>e.has(i)?b("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t),u=(i,e,t,n)=>(L(i,e,"write to private field"),n?n.call(i,t):e.set(i,t),t),h=(i,e,t)=>(L(i,e,"access private method"),t);import{r as c,R as A,j as r,L as M,_ as g}from"./index-BxrrBEnu.js";import{a as C}from"./app-ids-CkH1oDs0.js";import{S as Q}from"./star-icon-13JVrm6N.js";import{R as X}from"./right-arrow-icon-ClqGmHeW.js";import{T as G}from"./text-link-arrow-B-FL--lg.js";const N=i=>{const[e,t]=c.useState(!1);return c.useEffect(()=>{t(window.matchMedia(i).matches)},[]),c.useEffect(()=>{const n=window.matchMedia(i),s=o=>t(o.matches);return n.addEventListener("change",s),()=>n.removeEventListener("change",s)},[]),e};var x;class Z{constructor(){d(this,x);this.getReviewData=async e=>await(await fetch(l(this,x).call(this,e))).json(),u(this,x,({appId:e,dataType:t="json",countryCode:n="us",page:s=1})=>`https://itunes.apple.com/${n}/rss/customerreviews/page=${s}/id=${e}/sortBy=mostRecent/${t}?l=en&cc=gb`)}}x=new WeakMap;const{getReviewData:Y}=new Z;var E,y,R,p,S,j,I,w;class q{constructor(){d(this,E);d(this,y);d(this,R);d(this,p);d(this,S);d(this,j);d(this,I);d(this,w);this.validateReviewMsg=async({data:e,settings:t})=>{const n=getComputedStyle(e.origElem),s=l(this,R).call(this,{data:{origElemStyles:n}}),o=l(this,S).call(this,{data:{origElemStyles:n},settings:t}),m=e.origElem.scrollHeight>o;if(e.origElem.dataset.overflowFlag==="true"||m){e.origElem.dataset.overflowFlag="true",document.body.appendChild(s);const J=await l(this,E).call(this,{data:{...e,tempElem:s},settings:{maxHeight:o}});document.body.removeChild(s);const K=l(this,p).call(this,t.endElem).length;return{overflowFlag:!0,content:[await l(this,y).call(this,{data:e,settings:{endElemLength:K,truncationIndex:J}}),t.endElem]}}return e.origElem.dataset.overflowFlag="false",{overflowFlag:!1,content:[e.origMsg]}},u(this,E,async({data:e,settings:t})=>{if(!e.origMsg.length)return 0;let n=0,s=e.origMsg.length-1;for(;n<=s;){const o=Math.floor((n+s)/2),m=e.origMsg.substring(0,o);e.tempElem.textContent=m,e.tempElem.scrollHeight<=t.maxHeight?n=o+1:s=o-1}return s}),u(this,y,async({data:e,settings:t})=>{if(t.truncationIndex===0)return e.origMsg;const n=t.truncationIndex-t.endElemLength,s=e.origMsg.lastIndexOf(" ",n);return s<0?e.origMsg.substring(0,n):e.origMsg.substring(0,s).replace(new RegExp("\\p{P}+$","gu"),"").trim()}),u(this,R,({data:e})=>{const t=document.createElement("div");return t.style.position="absolute",t.style.visibility="hidden",t.style.overflow="hidden",t.style.display="inline-block",t.style.whiteSpace="pre-wrap",t.style.fontSize=e.origElemStyles.fontSize,t.style.lineHeight=e.origElemStyles.lineHeight,t.style.fontFamily=e.origElemStyles.fontFamily,t.style.padding=e.origElemStyles.padding,t.style.margin=e.origElemStyles.margin,t.style.border=e.origElemStyles.border,t.style.maxWidth=e.origElemStyles.width,t.style.maxHeight=e.origElemStyles.height,t}),u(this,p,e=>typeof e=="string"?e:typeof e=="number"?e.toString():A.isValidElement(e)?A.Children.toArray(e.props.children).map(l(this,p)).join(""):""),u(this,S,({data:e,settings:t})=>t.rows*l(this,j).call(this,{data:{origElemStyles:e.origElemStyles}})),u(this,j,({data:e})=>parseFloat(e.origElemStyles.lineHeight)||parseFloat(e.origElemStyles.fontSize)),this.validateReviewData=async({reviewData:e,arrLength:t})=>e?Array.isArray(e)?e.length<t?[...e,...l(this,w).call(this,t-e.length)]:e:[e,...l(this,w).call(this,t-1)]:l(this,w).call(this,t),u(this,I,()=>({filler:!0})),u(this,w,e=>Array(e).fill(l(this,I).call(this)))}}E=new WeakMap,y=new WeakMap,R=new WeakMap,p=new WeakMap,S=new WeakMap,j=new WeakMap,I=new WeakMap,w=new WeakMap;const{validateReviewData:T,validateReviewMsg:ee}=new q;var a,W,$,O,v,F;class te{constructor(){d(this,a);this.sortReviews=async({validatedData:e,lang:t})=>e.sort((n,s)=>h(this,a,v).call(this,n)&&h(this,a,v).call(this,s)?0:h(this,a,v).call(this,n)?1:h(this,a,v).call(this,s)?-1:h(this,a,W).call(this,n,s,t))}}a=new WeakSet,W=function(e,t,n){const s=h(this,a,O).call(this,e,t);return s!==0?s:h(this,a,$).call(this,e,t,n)},$=function(e,t,n){const s=h(this,a,F).call(this,e.content.label,n),o=h(this,a,F).call(this,t.content.label,n);return s===o?0:s&&!o?-1:1},O=function(e,t){const n=parseInt(e["im:rating"].label);return parseInt(t["im:rating"].label)-n},v=function(e){return"filler"in e},F=function(e,t){const s={ar:/[\u0621-\u064A\u0660-\u0669]/,en:/[a-zA-Z]/,ru:/[а-яА-ЯёЁ]/,de:/[äöüß]/,hi:/[अ-ह]/,es:/[ñáéíóúü]/,fr:/[àâçéèêëîïôûù]/,zh:/[\u4E00-\u9FFF]/,ja:/[\u3040-\u30FF\uFF00-\uFFEF]/,pt:/[ãáâéêíóôú]/,uk:/[єіїґ]/}[t];return s?s.test(e):!1};const{sortReviews:ie}=new te;class ne{constructor(){this.getAppId=()=>{const t=new URL(document.URL).pathname.split("/");let n;for(n in C)if(t.includes(n))return C[n];throw new Error(`ID NOT FOUND, pathnameItems:${JSON.stringify(t)}, appIds: ${JSON.stringify(C)}`)},this.getAppStoreLink=({data:e,option:t})=>`https://apps.apple.com/${e.countryCode||"us"}/app/id${e.appId}${t&&`?${t}`}`}}const{getAppId:Ie,getAppStoreLink:V}=new ne,re=({codes:i,arrLength:e=3,appId:t})=>{const[n,s]=c.useState(null);return c.useEffect(()=>{Y({appId:t,countryCode:i.countryCode||"us"}).then(o=>T({reviewData:o.feed.entry,arrLength:e})).then(o=>ie({validatedData:o,lang:i.languageCode||"en"})).then(o=>s(o)).catch(()=>T({reviewData:[],arrLength:e}).then(o=>s(o)))},[]),{reviews:n}},P=c.createContext(null);function f(){const i=c.useContext(P);if(!i)throw new Error("ReviewContext must be used inside ReviewProvider");return i}function se({head:i,description:e,link:t,slider:n}){return r.jsxs(B,{children:[r.jsxs("header",{className:"review__header",children:[i,t]}),e,n]})}function oe({head:i,description:e,link:t,slider:n}){return r.jsxs(B,{children:[r.jsx("header",{className:"review__header",children:i}),e,n,r.jsx("footer",{className:"review__link-wrapper pt-4",children:t})]})}function B({children:i}){return r.jsx("section",{children:r.jsx("div",{className:"row review py-5",children:i})})}function D(){const{text:i}=f();return r.jsx("h2",{children:i.head})}function k(){const{text:i}=f();return r.jsx("p",{className:"review__description",children:i.description})}const ae=(i,e)=>{let t;return(...n)=>{t&&clearTimeout(t),t=setTimeout(()=>i(...n),e)}},le=(i=1e3)=>{const[e,t]=c.useState({width:window.innerWidth,height:window.innerHeight});return c.useEffect(()=>{const n=ae(()=>{t({width:window.innerWidth,height:window.innerHeight})},i);return window.addEventListener("resize",n),()=>{window.removeEventListener("resize",n)}},[i]),e},ce=({data:i,settings:e})=>{const t=c.useRef(null),n=le(e.resizeDelay),[s,o]=c.useState({overflowFlag:!1,content:[i.origMsg]});return c.useLayoutEffect(()=>{const m=t.current;m&&ee({data:{...i,origElem:m},settings:e}).then(_=>o(_))},[n]),{validatedData:s,reviewTextRef:t}},de=i=>new Date(i).toLocaleDateString("ru-RU");function ue({reviewerNickname:i,createdDate:e,reviewText:t,rating:n}){const{reviewTextRef:s,validatedData:o}=ce({data:{origMsg:t},settings:{rows:8,resizeDelay:100,endElem:r.jsx("span",{children:"..."},t)}});return r.jsxs("li",{className:"review-card",children:[r.jsxs("header",{className:"review-card__header",children:[r.jsxs("div",{className:"review-card__header-main",children:[r.jsx("h3",{children:i}),r.jsxs("span",{className:"review-card__header-rating",children:[r.jsx(Q,{}),n,",0"]})]}),r.jsx("time",{dateTime:e,children:de(e)})]}),r.jsx("p",{ref:s,children:o.content})]})}function he({link:i,posIndex:e}){const{text:t}=f();return r.jsx("li",{className:"review-card filler-card",children:r.jsxs("div",{className:"filler-card__wrapper",children:[r.jsx("h3",{className:"filler-card__header",children:t.fillerCard.head[e]}),i]})})}function me(){const{data:i,text:e}=f();return r.jsx(U,{text:e.fillerCard.link,href:V({data:{appId:i.appId,countryCode:i.countryCode},option:"action=write-review"})})}function H(){const{data:i,text:e}=f();return r.jsx(U,{text:e.link,href:V({data:{appId:i.appId,countryCode:i.countryCode},option:"see-all=reviews"})})}function U(i){return r.jsx(G,{rightIcon:r.jsx(X,{}),isNewTab:!0,...i})}function z(){const{data:i,text:e}=f();return r.jsx("ul",{className:"review__list",children:i.reviews.map((t,n)=>"filler"in t?r.jsx(he,{link:r.jsx(me,{}),posIndex:n},e.fillerCard.head[n]):r.jsx(ue,{createdDate:t.updated.label,reviewText:t.content.label,reviewerNickname:t.author.name.label,rating:t["im:rating"].label},t.id.label))})}const ge=992,we=1400;function pe({text:i,appId:e,codes:t}){const n=N(`(max-width: ${ge}px)`),s=N(`(max-width: ${we}px)`),o=n?1:s?2:3,{reviews:m}=re({codes:t,arrLength:o,appId:e});return!m||!e?r.jsx(r.Fragment,{}):r.jsx(P.Provider,{value:{data:{reviews:m.slice(0,o),appId:e,countryCode:t.countryCode},text:i},children:n?r.jsx(oe,{head:r.jsx(D,{}),description:r.jsx(k,{}),link:r.jsx(H,{}),slider:r.jsx(z,{})}):r.jsx(se,{head:r.jsx(D,{}),description:r.jsx(k,{}),link:r.jsx(H,{}),slider:r.jsx(z,{})})})}const Ce={title:"Prototype"},fe=()=>r.jsx(pe,{appId:C.vitamin,codes:{countryCode:M.countryCode,languageCode:M.language},text:{head:g("REVIEW.HEAD"),description:g("REVIEW.DESCRIPTION"),link:g("REVIEW.LINK_ALL_REVIEWS"),fillerCard:{head:[g("REVIEW.FILLER_CARD.HEAD1"),g("REVIEW.FILLER_CARD.HEAD2"),g("REVIEW.FILLER_CARD.HEAD3")],link:g("REVIEW.FILLER_CARD.LINK")}}});fe.storyName="Review";typeof window<"u"&&window.document&&window.document.createElement&&document.documentElement.setAttribute("data-storyloaded","");export{fe as ReviewStory,Ce as default};
